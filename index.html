<!DOCTYPE html>
<html>
  <head>
    <title>Wavetable Oscillators</title>
    <style>
      body {
        display: grid;
        place-items: center;
      }
    </style>
  </head>
  <body>
    <nav><code id="rx1">trap</code> music</nav>

    <div
      style="
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        height: 200px;
        place-items: center;
      "
    >
      <div><canvas id="input_freq"></canvas></div>
      <div><canvas id="output_freq"></canvas></div>
      <div><canvas id="canvas1"></canvas></div>
      <div><canvas id="canvas2"></canvas></div>
    </div>

    <main
      style="
        display: grid;
        grid-template-columns: 1fr 1fr;
        max-width: 1024;
        height: 200px;
        place-items: center;
      "
      class="container"
    ></main>
  </body>
  <div id="msg"></div>
  <pre></pre>
  <template></template>
  <script type="module" src="./dist/main-thread.js"></script>
  <!-- <script>
    const console = document.querySelector("pre");
    const divv = document.querySelector("#msg");
    let stateBuffer, inputBuffer, outputBuffer;
    let inputOffset = 0,
      sharedBuffer = null;
    const stateBufferLength = 8 * BigInt64Array.BYTES_PER_ELEMENT;

    const worker = new Worker("dist/worker.js", { type: "module" });
    if (sharedBuffer) {
      stateBuffer = new BigInt64Array(sharedBuffer, 0, 8);
      inputBuffer = new Uint32Array(
        sharedBuffer,
        8 * BigInt64Array.BYTES_PER_ELEMENT,
        1024
      );
      oscillatorStates = new Uint8Array(
        sharedBuffer,
        8 * BigInt64Array.BYTES_PER_ELEMENT + 1024 * Uint32Array,
        0x7fff
      );
      window.onkeydown = (e) => {
        inputBuffer[inputOffset++] = e.key;
        stateBuffer[0] = BigInt(1);
        Atomics.notify(stateBuffer, StateEventIndex.user_input, 1 << 32);
      };
    }
    const StateEventIndex = {
      worker_init: 0,
      user_input: 1,
      user_input_set: 2,
      playback_on: 3,
    };
    worker.onmessage = function ({ data: { sharedBuffer, msg, info } }) {
      if (info) divv.innerHTML = JSON.stringify(info);
    };
    worker.onerror = (e) =>
      (divv.innerHTML = e.message + " ERROR ;" + e.toString());
  </script> -->
  <script></script>
</html>
